parameters:
  env: ''
  workingDirectory: ''
  
steps:
- task: DownloadSecureFile@1
  name: varFile
  displayName: 'Download varFile'
  inputs:
    secureFile: 'tfvars-${{parameters.env}}.json'
- bash: |
    terraform plan --var-file="$(varFile.secureFilePath)" -out $(terraformPlanFile)
  displayName: Terraform Plan
  env:
    ARM_SUBSCRIPTION_ID:        $(kv-arm-subscription-id)
    ARM_CLIENT_ID:              $(kv-arm-client-id)
    ARM_CLIENT_SECRET:          $(kv-arm-client-secret)
    ARM_TENANT_ID:              $(kv-arm-tenant-id)
  workingDirectory: ${{ parameters.workingDirectory }}
